
#Frida Cheatsheet

Click here for [Objection cheatsheet](./Objection_iOS_Cheatsheet.md)
Click here for [R2_R2Frida_Cheatsheet](./R2_R2Frida_Cheatsheet.md)

## Frida
Full JS API at: https://frida.re/docs/javascript-api/

### iOS commands

Spawn app: 
```
frida -U -f <bundle id> --no-pause
//--no-pause is optional
```

Attach to running app:
```
frida -U <app name>
```

Load a script:
```
frida -U <app_name> -l <script>
```

List loaded classes
```
ObjC.enumerateLoadedClasses({
  onMatch(name, owner) {
    console.log('onMatch:', name, owner);
  },
  onComplete() {
  }
});
```
List a class methods:
```
ObjC.classes["NSString"].$ownMethods
```

Get the arg types of a given method:
```
//For a class named: "House" and a method named "- openDoor":
ObjC.classes.House['- openDoor'].argumentTypes
```

Get the return type of a given method:
```
//For a class named: "House" and a method named "- openDoor":
ObjC.classes.House['- openDoor'].returnType
```

Get a live instance of a class:
```
For a class named: "House":
var objInst=ObjC.chooseSync(ObjC.classes.House)[0]
```

Or create a new instance of a class:
```
For a class named: "House":
var objInst = ObjC.classes.House.alloc().init();
```

Call a method from the obj instance (previously created):
```
For a class named: "House" and a method named "- openDoor":
objInst["- openDoor"](paramValue)

or

objInst.openDoor(paramValue)
```

Instrumenting a method:
```
//For a class named: "House" and a method named "- openDoor":
    // As this is an Objective-C method, the arguments are as follows:
    // 0. 'self'
    // 1. The selector (openDoor:)
    // 2. The first argument to the method (if any)
Interceptor.attach(ObjC.classes.House['- openDoor'].implementation,
{
  onEnter: function (args) {
  	var arg = ObjC.Object(args[2]).toString();
	   send('First argument is ' + arg);
  },
  onLeave: function (retval) {
  		var ret = ObjC.Object(retval).toString()
  	 	send('return value is ' + ret);
  }
});
```

Tracing a Native Function:
```
// List Modules
Process.enumerateModules()

//get specific module and enumerate its exports
var mod = Process.enumerateModules()[1]
mod.enumerateExports()

//For a library called: houseNative.dylib and a function called "openDoorNative"
	// The following finds the address in memory of the function
var funcPtr = Module.findExportByName('houseNative.dylib', 'openDoorNative');

Interceptor.attach(funcptr,
{
  onEnter: function (args) {
  	console.log("Function Executed ")
  	console.log("Args: "+ ObjC.Object(args[0]))
  },
  onLeave: function (retval) {
  	console.log("Retval: "+ retval)
  }
});
```

Calling a Native function:
```
//For a library called: houseNative.dylib and a function called "openDoorNative"
	// The following finds the address in memory of the function
var funcPtr = Module.findExportByName('houseNative.dylib', 'openDoorNative');

	// The following creates the native function
	// first param is pointer (NativePointer)
	//second param is return type
	// Third param is an array of arguments for the function
var myFunction = new NativeFunction(funcPtr, 'char', ['pointer']);
```
